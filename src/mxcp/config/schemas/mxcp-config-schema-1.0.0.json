{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "MXCP Config",
  "type": "object",
  "required": ["mxcp", "projects"],
  "properties": {
    "mxcp": {
      "type": "string",
      "description": "Schema version. Always use '1.0.0'.",
      "default": "1.0.0"
    },
    "auth": {
      "type": "object",
      "description": "Authentication configuration for the MCP server.",
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["none", "github"],
          "default": "none",
          "description": "Authentication provider to use."
        },
        "clients": {
          "type": "array",
          "description": "Pre-registered OAuth clients for development and testing.",
          "items": {
            "type": "object",
            "required": ["client_id", "name"],
            "properties": {
              "client_id": {
                "type": "string",
                "description": "OAuth client ID."
              },
              "client_secret": {
                "type": "string",
                "description": "OAuth client secret (optional for public clients)."
              },
              "name": {
                "type": "string",
                "description": "Human-readable name for this client."
              },
              "redirect_uris": {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "uri"
                },
                "description": "Allowed redirect URIs for this client.",
                "default": ["http://127.0.0.1:49153/oauth/callback"]
              },
              "grant_types": {
                "type": "array",
                "items": {
                  "type": "string",
                  "enum": ["authorization_code", "refresh_token"]
                },
                "description": "Allowed OAuth grant types.",
                "default": ["authorization_code"]
              },
              "scopes": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Allowed OAuth scopes.",
                "default": ["mxcp:access"]
              }
            },
            "additionalProperties": false
          }
        },
        "github": {
          "type": "object",
          "description": "GitHub OAuth configuration (required when provider is 'github').",
          "required": ["client_id", "client_secret", "callback_path", "auth_url", "token_url"],
          "properties": {
            "client_id": {
              "type": "string",
              "description": "GitHub OAuth client ID."
            },
            "client_secret": {
              "type": "string",
              "description": "GitHub OAuth client secret."
            },
            "scope": {
              "type": "string",
              "description": "OAuth scope to request (optional).",
              "default": "user:email"
            },
            "callback_path": {
              "type": "string",
              "description": "Callback path for OAuth flow.",
              "default": "/github/callback"
            },
            "auth_url": {
              "type": "string",
              "format": "uri",
              "description": "GitHub authorization URL."
            },
            "token_url": {
              "type": "string",
              "format": "uri",
              "description": "GitHub token exchange URL."
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "vault": {
      "type": "object",
      "description": "Configuration for Vault integration.",
      "required": ["enabled"],
      "properties": {
        "enabled": { "type": "boolean" },
        "address": {
          "type": "string",
          "format": "uri"
        },
        "token_env": {
          "type": "string",
          "description": "The environment variable name containing the Vault token."
        }
      },
      "additionalProperties": false
    },
    "transport": {
      "type": "object",
      "description": "Default transport configuration for serving endpoints.",
      "properties": {
        "provider": {
          "type": "string",
          "enum": ["streamable-http", "sse", "stdio"],
          "default": "streamable-http",
          "description": "Default transport protocol to use."
        },
        "http": {
          "type": "object",
          "description": "HTTP transport specific configuration.",
          "properties": {
            "port": {
              "type": "integer",
              "minimum": 1,
              "maximum": 65535,
              "default": 8000,
              "description": "Default port number for HTTP transport."
            },
            "host": {
              "type": "string",
              "default": "localhost",
              "description": "Default host to bind the HTTP server to."
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "projects": {
      "type": "object",
      "description": "All configured RAW projects.",
      "patternProperties": {
        "^[a-zA-Z0-9_-]+$": {
          "type": "object",
          "required": ["profiles"],
          "properties": {
            "default": {
              "type": "string",
              "description": "Default profile name for this project."
            },
            "profiles": {
              "type": "object",
              "description": "Profiles under this project.",
              "patternProperties": {
                "^[a-zA-Z0-9_-]+$": {
                  "type": "object",
                  "properties": {
                    "secrets": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "required": ["name", "type", "parameters"],
                        "properties": {
                          "name": { "type": "string", "description": "The secret name." },
                          "type": { "type": "string", "description": "The secret type." },
                          "parameters": {
                            "type": "object",
                            "description": "The secret definition.",
                            "additionalProperties": {
                              "oneOf": [
                                { "type": "string" },
                                { 
                                  "type": "object",
                                  "additionalProperties": { "type": "string" }
                                }
                              ]
                            }
                          }
                        },
                        "additionalProperties": false
                      }
                    },
                    "plugin": {
                      "type": "object",
                      "description": "Plugin configuration for this profile.",
                      "properties": {
                        "config": {
                          "type": "object",
                          "description": "Plugin-specific configurations.",
                          "patternProperties": {
                            "^[a-zA-Z0-9_-]+$": {
                              "type": "object",
                              "description": "Configuration for a specific plugin.",
                              "additionalProperties": {
                                "type": "string"
                              }
                            }
                          },
                          "additionalProperties": false
                        }
                      },
                      "additionalProperties": false
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
